# 功能检查步骤指南

## 📍 项目信息
- **项目路径**: `/Users/christianyang857/Desktop/notra-website`
- **项目名**: `notra-website`

---

## 🔍 第一步：检查环境变量

在终端中执行：

```bash
cd /Users/christianyang857/Desktop/notra-website
cat .env.local
```

**应该看到**：
```
OPENAI_API_KEY=sk-...
```

**如果看不到或为空**：
1. 编辑 `.env.local` 文件
2. 添加：`OPENAI_API_KEY=你的密钥`
3. 保存文件
4. **重启开发服务器**（重要！）

---

## 🔍 第二步：检查开发服务器是否运行

在终端中执行：

```bash
cd /Users/christianyang857/Desktop/notra-website
ps aux | grep "next dev" | grep -v grep
```

**如果看到进程**：✅ 服务器正在运行
**如果看不到**：需要启动服务器

### 启动开发服务器：

```bash
cd /Users/christianyang857/Desktop/notra-website
npm run dev
```

**应该看到**：
```
  ▲ Next.js 16.0.3
  - Local:        http://localhost:3000
```

---

## 🔍 第三步：测试文件上传功能

### 3.1 打开浏览器
访问：`http://localhost:3000/dashboard`

### 3.2 打开浏览器开发者工具
- **Mac**: 按 `Cmd + Option + I`
- **Windows**: 按 `F12` 或 `Ctrl + Shift + I`

### 3.3 切换到 Console 标签
这里会显示所有 JavaScript 错误和日志

### 3.4 切换到 Network 标签
这里会显示所有网络请求

### 3.5 尝试上传文件
1. 在 Dashboard 页面点击 "Upload File" 或拖拽文件
2. 选择一个测试文件（.txt, .pdf, .docx 等）

### 3.6 观察结果

#### 在 Console 标签中查看：
- ✅ 如果成功：应该看到 `File upload error:` 后面没有错误
- ❌ 如果有错误：会显示红色错误信息，**复制这些错误信息**

#### 在 Network 标签中查看：
1. 找到 `/api/process/file` 请求（可能显示为红色）
2. 点击这个请求
3. 查看 **Response** 标签页
4. **复制 Response 内容**（这是服务器返回的错误信息）

---

## 🔍 第四步：查看服务器终端日志

在运行 `npm run dev` 的终端窗口中，应该看到：

### 成功时的日志：
```
[File API] Starting learning asset generation, text length: 1234
[LearningAssetGenerator] Calling OpenAI API, model: gpt-4o-mini, text length: 1234
[LearningAssetGenerator] OpenAI response received, length: 5000
[LearningAssetGenerator] JSON parsed successfully
[File API] Learning asset generated successfully: { title: '...', notesCount: 5, ... }
[File API] Creating session with data: { ... }
[File API] Session created successfully: abc123
```

### 失败时的日志：
```
[File API] Starting learning asset generation, text length: 1234
[LearningAssetGenerator] Calling OpenAI API, model: gpt-4o-mini, text length: 1234
[LearningAssetGenerator] OpenAI response received, length: 100
[LearningAssetGenerator] JSON parse error: ...
```

**复制所有错误日志**

---

## 🔍 第五步：常见错误和解决方案

### 错误1: "OpenAI API key not configured"
**原因**: `.env.local` 中没有 `OPENAI_API_KEY` 或服务器没有重启

**解决**:
```bash
# 1. 检查 .env.local
cat .env.local

# 2. 如果没有，添加密钥
echo "OPENAI_API_KEY=sk-你的密钥" >> .env.local

# 3. 重启服务器（按 Ctrl+C 停止，然后重新运行）
npm run dev
```

### 错误2: "Failed to parse OpenAI response as JSON"
**原因**: OpenAI API 返回了非 JSON 格式

**解决**: 查看服务器日志中的响应内容，告诉我具体返回了什么

### 错误3: "Failed to save session"
**原因**: 数据库文件权限问题

**解决**:
```bash
# 检查 .notra-data 目录权限
ls -la .notra-data

# 如果不存在，创建它
mkdir -p .notra-data
chmod 755 .notra-data
```

### 错误4: HTTP 500 错误
**原因**: 服务器内部错误

**解决**: 
1. 查看服务器终端日志（第四步）
2. 复制完整的错误堆栈信息
3. 告诉我具体的错误信息

---

## 📋 需要收集的信息

如果功能还是用不了，请收集以下信息：

1. **浏览器 Console 错误**（截图或复制文本）
2. **Network 标签中的 Response**（复制 `/api/process/file` 的 Response）
3. **服务器终端日志**（复制所有红色错误信息）
4. **具体操作步骤**（你做了什么，期望什么结果，实际发生了什么）

把这些信息发给我，我会继续修复！

